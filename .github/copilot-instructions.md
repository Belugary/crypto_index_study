<!-- Copilot 自动化开发指南 -->

# 区块链资产指数研究项目开发指南

本指南为 AI 助手提供项目开发的核心原则、工作流和资产管理规范。

---

## 1. 项目核心原则

### 1.1. 项目目标

- **核心目的**: 区块链资产指数研究与量化分析。
- **技术栈**: Python, CoinGecko API, 数据分析工具链。
- **数据源**: CoinGecko Pro API (通过 `.env` 文件配置)。

### 1.2. API 使用

- **分类**: 基础 (🔹), Premium (💼), Analyst (👑)。
- **规范**: 使用 `requests.Session()` 复用连接，所有方法需包含详细参数说明和错误处理。

---

## 2. 开发工作流

### 2.1. 代码风格

- **注释与文档**: 使用中文注释和详细的类型提示。
- **用户提示**: API 调用前后需有明确的状态提示信息。

### 2.2. 测试要求

- **位置**: 所有测试文件必须放在 `tests/` 目录。
- **内容**: 每个新增的 API 功能都应有对应的测试，并包含清晰的成功/失败总结。

---

## 3. 配置一致性原则 (重要)

### 3.1. 核心配置参数

**数据范围**: 市值前 500 名币种 (不可随意更改)

### 3.2. 一致性检查清单

任何涉及数据范围或核心配置的修改，必须检查以下位置的一致性：

1. **代码层面**:

   - `scripts/update_price_data.py` 中所有默认参数值
   - `main.py` 中的示例和说明文本
   - 函数签名中的默认值 (如 `n=500`, `top_n=500`)
   - 帮助文档字符串和命令行参数描述

2. **文档层面**:

   - `README.md` 中的功能描述和数据范围说明
   - `.github/copilot-instructions.md` 中的数据资产范围
   - 任何包含数值的表格、列表或示例

3. **配置层面**:
   - 所有脚本的命令行参数默认值
   - 配置文件中的相关设置
   - 测试文件中的期望值 (虽然测试可用小数据集)

### 3.3. 防范措施

- **单一数据源原则**: 所有关键配置应有唯一的定义源，其他地方引用而非重复定义
- **修改前检查**: 任何数值修改前，使用 `grep_search` 工具搜索项目中所有相关出现
- **批量验证**: 修改后运行完整测试套件，确保所有功能正常
- **文档同步**: 代码修改后立即更新所有相关文档

---

## 4. 资产管理

### 4.1. 数据资产 (核心)

- **范围**: 市值前 500 名币种的日级别历史量价数据。
- **过滤**: 自动识别并可选择排除稳定币 (25 个) 和包装币 (87 个)。
- **更新规范**:
  1. **README**: 必须更新 `(最近更新: YYYY-MM-DD)`。
  2. **Git 提交**: 必须使用 `📊 数据更新: ...` 格式。
  3. **质量**: 定期检查数据完整性、质量和一致性。

### 4.2. 文件系统

- **核心原则**: 保持简洁，避免临时文件，所有文件都应有明确的长期价值。
- **目录结构**:
  ```
  src/         # 核心功能代码
  scripts/     # 自动化脚本
  examples/    # 使用示例
  tests/       # 测试代码
  data/        # 数据资产 (coins/, metadata/)
    ├── coins/         # 币种历史价格数据
    ├── metadata/      # 元数据文件
    │   ├── native_coins.csv    # 原生币清单
    │   ├── stablecoins.csv     # 稳定币清单
    │   └── wrapped_coins.csv   # 包装币清单
    └── daily/         # 日级别聚合数据
  logs/        # 日志文件
  ```
- **日志管理**:
  - 所有日志统一存放在根目录的 `logs/` 中。
  - `.gitignore` 已配置忽略本地日志文件。
- **禁止的文件**:
  - 根目录禁止创建任何 `test_*.py`, `temp_*.py`, `debug_*.py` 等临时脚本。
  - 避免创建功能重复的文件。

### 4.3. 文档管理

- **核心文档**:
  - `README.md`: 用户使用指南。
  - `CHANGELOG.md`: 版本更新日志。
  - `.github/copilot-instructions.md`: AI 开发指南。
- **更新原则**:
  - **同步性**: 代码更新后，必须同步更新所有相关文档。
  - **一致性**: 所有文档中的功能描述、路径引用和数据范围必须保持一致。
  - **简洁性**: 避免冗余和过度工程化的文档。
- **质量检查**: 更新后需检查路径引用、数据描述和时间戳是否正确。

---

## 5. 变更管理最佳实践

### 5.1. 配置变更流程

1. **影响评估**: 使用 `grep_search` 全项目搜索相关配置
2. **批量更新**: 一次性更新所有相关位置，避免遗漏
3. **测试验证**: 运行完整测试套件确保功能正常
4. **文档同步**: 立即更新所有相关文档
5. **一致性检查**: 再次搜索确认无遗漏

### 5.2. 代码质量守则

- **参数传递**: 优先使用参数传递而非硬编码常量
- **配置中心化**: 重要配置集中定义，避免分散重复
- **依赖注入**: 支持测试和生产环境的不同配置
- **向后兼容**: 新功能不破坏现有接口

### 5.3. 错误防范

- **强制检查**: 任何数值修改都必须进行全项目一致性检查
- **自动化测试**: 关键配置变更必须有测试覆盖
- **版本控制**: 重要变更前创建分支，便于回滚
- **文档审查**: 变更后必须检查所有相关文档是否同步更新

### 5.4. 深层架构原则

- **单一职责**: 每个配置参数应有明确的唯一定义源
- **可测试性**: 所有配置都应支持依赖注入以便测试
- **可维护性**: 配置变更应有明确的影响范围和变更流程
- **可追溯性**: 配置变更必须有完整的文档记录和测试验证
