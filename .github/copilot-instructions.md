<!-- Copilot 自动化开发指南 -->

# 区块链资产指数研究项目开发指南

本指南为 AI 助手提供项目开发的核心原则、工作流和资产管理规范。

---

## 1. 核心原则与工作流

### 1.1. 项目目标与技术栈

- **核心目的**: 区块链资产指数研究与量化分析。
- **技术栈**: Python, CoinGecko API
- **数据源**: CoinGecko Pro API (通过 `.env` 文件配置)。

### 1.2. 代码风格与测试

- **注释**: 使用中文注释和详细的类型提示。
- **用户提示**: API 调用前后需有明确的状态提示信息。
- **测试**: 所有测试必须放在 `tests/` 目录，并覆盖新增的 API 功能。

---

## 2. 配置与数据一致性 (重要)

### 2.1. 核心配置原则

- **目标导向**: 用户参数 (如 `target_native_coins=510`) 是**目标结果**，而非搜索限制。系统需自动调整内部逻辑（如扩展 API 查询范围）来达成该目标。
- **单一来源**: 关键配置应有唯一的定义源，其他地方引用而非重复定义。

### 2.2. 一致性检查清单

任何涉及核心配置的修改，必须使用 `grep_search` 等工具检查并同步更新以下所有相关项：

- **代码**: `scripts/` 和 `main.py` 中的默认参数、函数签名、帮助文档。
- **文档**: `README.md` 和本指南中的功能描述与数据范围。
- **测试**: 测试文件中的期望值。

---

## 3. 资产与文档管理

### 3.1. 数据资产

- **范围**: 市值前 600 名币种的日级别历史数据，原生币目标数默认为 510。
- **分类**: 自动识别并可选择排除稳定币 (80 个) 和包装币 (24 个)。
- **更新规范**:
  - **README**: 必须更新 `(最近更新: YYYY-MM-DD)`。
  - **Git 提交**: 必须使用 `📊 数据更新: ...` 格式。

### 3.2. 文件与日志

- **核心目录**: `src/` (核心代码), `scripts/` (自动化脚本), `tests/` (测试), `data/` (数据资产)。
- **日志**: 所有日志统一存放在根目录的 `logs/` 中。
- **禁止**: 根目录禁止创建任何临时脚本 (`test_*.py`, `temp_*.py` 等)。

### 3.3. 文档管理

- **核心文档**: `README.md` (用户指南), `CHANGELOG.md` (更新日志), 本文件 (开发指南)。
- **同步性**: 代码更新后，必须同步更新所有相关文档。
- **README 优化原则**:
  - **用户视角**: 围绕“用户如何用、能得到什么结果”展开。
  - **简洁至上**: 突出核心价值和操作步骤，避免冗余技术细节。
  - **结构建议**: 快速开始和常用命令放前面，详细功能放后面。

### 3.4. Agent 上下文管理

- **核心原则**: 严格控制上下文大小，**严禁**在响应中列出 `data/` 目录下的海量文件内容或 diff。
- **执行细则**: 在 `git status` 等场景下，对 `data/` 目录的变更**必须**进行总结性描述（例如：“发现 N 个新的数据文件”）。

---

## 4. 核心开发哲学 (根本原则)

### 4.1. 根因分析 (五问法)

在解决问题时，必须超越表象，探究根本原因。

**案例：数据分类错误**

- **第一层 (表象)**: 为什么原生币数量不足？
  - **答案**: 因为稳定币和包装币被过度分类，排除了过多的原生币。
- **第二层 (直接原因)**: 为什么会过度分类？
  - **答案**: 因为分类逻辑过于复杂，使用了宽泛的自定义关键词匹配。
- **第三层 (深层原因)**: 为什么会使用复杂的自定义逻辑？
  - **答案**: 因为不信任官方数据源的权威性，试图“做得更全面”。
- **第四层 (哲学原因)**: 为什么不信任权威数据源？
  - **答案**: 因为存在“过度工程化”的思维惯性，认为复杂的方案优于简单的方案。
- **第五层 (根本原因)**: **工程哲学偏差**。违背了“简单有效”的核心原则，陷入了对复杂性的盲目追求。

### 4.2. 必须遵循的原则

1.  **简单胜于复杂 (Simplicity First)**:

    - 遵循 Python 之禅，优先选择最简单、直接的解决方案。
    - **奥卡姆剃刀**: 如无必要，勿增实体。

2.  **信任权威数据源 (Authoritative Source Priority)**:

    - CoinGecko 的官方分类是第一权威，自定义逻辑只能作为补充。

3.  **用户导向设计 (User-Centric Design)**:
    - 用户参数表达的是**期望的结果**，系统应负责实现它。
    - 接口设计应符合用户直觉，而非暴露技术细节。

### 4.3. 可执行的预防措施

- **复杂性告警**: 一个函数或方法中的 `if/else` 嵌套超过 3 层，或条件判断超过 5 个，应被视为“代码异味”，需要重构。
- **依赖检查**: 代码审查时，必须检查是否优先依赖了官方或权威的字段/接口。
