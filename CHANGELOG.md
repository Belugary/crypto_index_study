# 更新日志

所有此项目的重要变更都将记录在此文件中。

本项目遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) 格式，并使用 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [未发布] - 2025-07-11

### 🎉 重大改进

#### 原生币数量配置功能

- **新增 `--native-coins` 参数**: 支持用户自定义目标原生币数量（默认 510）
- **动态搜索范围扩展**: 实现智能搜索范围自动调整机制，确保能够获得足够的原生币
- **智能增量策略**: 根据缺口大小采用不同增量（500/300/200），优化搜索效率
- **目标导向设计**: 参数作为目标结果而非搜索限制，系统自动调整内部逻辑实现目标

#### 数据分类优化

- **修复稳定币分类**: 从过度分类的 126 个减少到准确的 80 个稳定币
- **修复包装币分类**: 从过度分类的 157 个减少到准确的 24 个包装币
- **严格分类标准**: 仅使用 CoinGecko 官方分类标签，避免自定义逻辑导致的误判

#### 数据范围扩展

- **数据规模**: 从 528 个币种扩展到 638 个币种
- **原生币达标**: 成功获得 534 个原生币，超过 500 个目标
- **数据质量**: 通过严格分类确保数据的准确性和可靠性

### 🔧 技术改进

#### 配置管理优化

- **一致性检查**: 建立了完整的配置一致性检查流程
- **文档同步**: 更新所有相关文档中的数值和描述
- **错误防范**: 增加了阶段性成果验证流程

#### 开发指南完善

- **数据分类严格性原则**: 新增章节，确保未来分类的准确性
- **阶段性成果验证流程**: 新增质量保证检查清单
- **配置变更流程**: 完善了变更管理最佳实践

### 📊 数据统计

- **总币种数**: 638 个 (↑ 110 个)
- **原生币数**: 534 个 (↑ 290 个)
- **稳定币数**: 80 个 (↓ 46 个)
- **包装币数**: 24 个 (↓ 133 个)

### ✨ 新增 (Added)

- **原生币配置系统**:

  - 新增 `--native-coins` 命令行参数，支持自定义目标原生币数量
  - 实现动态搜索范围扩展算法，自动调整搜索范围直到达成目标
  - 添加智能增量策略，基于缺口大小优化搜索效率
  - 提供详细的配置信息显示，包括"动态扩展"状态说明

- **包装币识别系统**:
  - 新增 `examples/wrapped_coin_checker.py` 包装币检测器
  - 基于 CoinGecko 官方分类标签进行精确识别
  - 支持识别包装代币、桥接代币、液态质押代币、代币化资产等
  - 自动排除 meme 币和治理代币，避免误判
  - 导出包装币清单到 CSV 文件

### 🔧 优化 (Changed)

- **搜索逻辑重构**:

  - 修正参数处理逻辑，将用户参数从"搜索限制"改为"目标结果"
  - 实现最大搜索范围动态计算：`max(target * 2, 2000)`
  - 优化增量扩展策略，避免无效的固定范围限制

- **代码整理**:
  - 清理临时文件和重复代码
  - 统一包装币检测器命名 (`WrappedCoinChecker`)
  - 重构文件结构，提高代码可维护性

### 🐛 修复 (Fixed)

- **参数逻辑错误**:

  - 修复将用户参数误解为"搜索限制"而非"目标结果"的根本性错误
  - 修正 `max_search_range` 计算逻辑，确保搜索范围足够大
  - 解决边界测试中暴露的核心逻辑缺陷

- **包装币分类精度**:
  - 修复 SPX6900 等 meme 币被错误识别为包装币的问题
  - 修复 BTC 衍生物被错误归类为 ETH 质押代币的问题
  - 修复 sUSDe 等收益型稳定币分类不准确的问题

---

## [1.2.1] - 2025-07-11

### 🐛 修复 (Fixed)

- **配置一致性修复**:
  - 统一项目中所有"前 500 名币种"的配置，解决了部分地方显示 300 的不一致问题
  - 修复 `scripts/update_price_data.py` 中所有默认参数为 500
  - 更新 `README.md` 中的功能描述保持一致性
  - 修正命令行帮助文档的默认值说明

### 🔧 优化 (Changed)

- **代码架构改进**:
  - `PriceDataUpdater` 增强依赖注入支持，构造函数支持可选的 `api`、`downloader`、`checker` 参数
  - 添加稳定币检查逻辑，主处理循环中自动跳过稳定币处理
  - 改进测试架构，支持更好的单元测试隔离

### ✨ 新增 (Added)

- **开发指南升级**:
  - 新增"配置一致性原则"章节，建立配置变更的标准流程
  - 建立完整的一致性检查清单，涵盖代码、文档、配置三个层面
  - 新增"变更管理最佳实践"，提供深层架构防范措施
  - 定义单一数据源原则、依赖注入模式等架构设计准则

---

## [1.2.0] - 2025-07-11

### ✨ 新增 (Added)

- **文档管理系统**:
  - 创建 `CHANGELOG.md` 用于记录版本历史。
  - 添加 `docs/` 目录和详细的下载状态说明。
- **日志管理系统**:
  - 统一所有日志到根目录 `logs/`。

### 🔧 优化 (Changed)

- **文档结构**:
  - 重构 `README.md`，突出核心功能和使用示例。
  - 优化 `copilot-instructions.md`，使其更清晰、简洁。
- **Git 配置**:
  - 优化 `.gitignore`，允许同步开发指南，同时保护敏感信息。
- **代码质量**:
  - 移除未使用的 `os` 导入，规范化代码格式。

### 🐛 修复 (Fixed)

- **路径引用**: 修复了 `BatchDownloader` 中错误的日志路径。
- **文档一致性**: 统一了所有文档中的数据范围、路径引用和功能描述。

---

## [1.1.0] - 2025-07-11

### ✨ 新增 (Added)

- **价格数据更新系统**:
  - `scripts/update_price_data.py` 实现完整的增量更新。
  - 自动发现和更新 Top 500 市值币种。
  - 实时进度跟踪和新币种自动集成。

### 🚀 性能优化 (Performance)

- **API 调用**: 优化至 461.5 calls/min (0.13s 间隔)。
- **执行效率**: 更新时间从 10+ 分钟降至 16.8 秒 (99.5% 节省)。

### 📊 数据资产 (Data)

- **范围扩展**: 数据覆盖从 Top 300 扩展到 Top 500。
- **数据更新**: 更新了 500+ 币种的价格数据，新增 11 个币种。

---

## [1.0.0] - 2025-07-10

### ✨ 新增 (Added)

- **项目基础架构**:
  - 建立核心目录结构 (`src/`, `data/`, `tests/`)。
  - 完整的 CoinGecko Pro API 客户端 (`src/api/coingecko.py`)。
- **元数据管理系统**:
  - `scripts/update_all_metadata.py` 用于更新元数据和稳定币信息。
- **批量下载器**:
  - `src/data/batch_downloader.py` 支持智能批量下载和缓存。
- **测试系统**:
  - `tests/` 目录包含全面的 API 测试覆盖。

---
