# 市值字段规格说明

## 重要澄清: 项目中使用的是流通市值

**日期**: 2025-07-14  
**验证方式**: 直接API测试  
**影响范围**: 所有指数计算、排名筛选、权重分配

## 字段定义

### market_cap (项目中使用)
- **定义**: 流通市值 (Circulating Market Cap)
- **计算公式**: `market_cap = 当前价格 × 流通供应量`
- **数据来源**: CoinGecko API `get_coin_market_chart` 端点的 `market_caps` 字段
- **用途**: 指数权重计算、币种排名、市场价值评估

### fully_diluted_valuation (未使用)
- **定义**: 完全稀释市值 (Fully Diluted Valuation)
- **计算公式**: `FDV = 当前价格 × 最大供应量`
- **特点**: 假设所有代币都已发行的理论市值

## API 验证结果

以 Bitcoin 为例 (2025-07-14测试):

```
市值类型                    数值
流通市值 (market_cap)       2,439,000,157,121 USD
完全稀释市值 (FDV)          2,439,000,157,121 USD
流通供应量                  19,892,090 BTC
最大供应量                  21,000,000 BTC
```

**Bitcoin 特殊情况**: 由于流通供应量接近最大供应量，两个市值相等。

## 其他币种示例对比

大多数币种的流通市值和完全稀释市值**不相等**:

| 币种 | 流通市值 | 完全稀释市值 | 差异原因 |
|------|----------|--------------|----------|
| Bitcoin | 几乎相等 | 几乎相等 | 接近最大供应量 |
| 其他代币 | 通常更小 | 通常更大 | 仍有未释放代币 |

## 为什么使用流通市值

### 金融标准
- **传统指数**: 标普500、纳斯达克等均使用流通市值
- **行业惯例**: CoinMarketCap、CoinGecko 排名均基于流通市值
- **投资实践**: 更准确反映可交易的市场价值

### 实际意义
- **可交易性**: 只计算实际可交易的代币
- **价格影响**: 流通供应量直接影响价格波动
- **市场深度**: 反映真实的市场流动性

## 影响范围

### 指数计算
- **权重分配**: 基于流通市值计算权重
- **成分筛选**: 按流通市值排名选择Top N
- **重平衡**: 定期根据流通市值调整

### 数据存储
- **CSV字段**: `market_cap` 列存储流通市值
- **历史数据**: 所有历史数据均为流通市值
- **一致性**: 整个项目数据保持一致

## 代码位置

### 关键文件
1. `src/downloaders/batch_downloader.py:299` - 数据提取
2. `src/index/market_cap_weighted.py:165` - 市值获取方法
3. `src/downloaders/daily_aggregator.py:1` - 聚合器说明

### 重要注释
所有相关代码已添加详细注释说明市值字段的具体含义。

## 验证方法

如需验证市值类型，可运行以下测试：

```python
from src.api.coingecko import create_api_client

api = create_api_client()
btc_market = api.get_coins_markets(ids='bitcoin')
coin = btc_market[0]
print(f'流通市值: {coin["market_cap"]}')
print(f'完全稀释市值: {coin["fully_diluted_valuation"]}')
```

## 结论

项目中的 `market_cap` 字段明确为**流通市值**，这是正确的选择，符合：
- 金融行业标准
- 指数编制惯例  
- 实际投资需求
- 数据可比性要求

---

**维护说明**: 如有API变更或字段定义更新，请及时更新本文档。
