# æ—¶é—´æˆ³ä¸æ—¥æœŸå¤„ç†å¤‡å¿˜å½•

**é‡è¦æé†’ï¼šå¤„ç†ä»»ä½•æ—¶é—´æˆ³ç›¸å…³é—®é¢˜å‰ï¼Œå¿…é¡»å…ˆé˜…è¯»æ­¤å¤‡å¿˜å½•ï¼**

## æ ¸å¿ƒåŸåˆ™

1. **æ°¸è¿œæ£€æŸ¥æ•°æ®æ ¼å¼**ï¼šCSV æ–‡ä»¶å¯èƒ½åŒ…å«è¡¨å¤´
2. **ç»Ÿä¸€ä½¿ç”¨å·¥å…·ç±»**ï¼šé¿å…ç›´æ¥æ“ä½œæ—¶é—´æˆ³
3. **æ˜ç¡®æ—¶åŒºå¤„ç†**ï¼šUTC vs æœ¬åœ°æ—¶é—´
4. **æ•°æ®ç±»å‹ä¸€è‡´æ€§**ï¼štimestamp å­—æ®µçš„æ•°æ®ç±»å‹

## å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1ï¼šCSV è¡¨å¤´å¤„ç†é”™è¯¯

```
ValueError: could not convert string to float: 'timestamp'
```

**åŸå› **ï¼šCSV æ–‡ä»¶åŒ…å«è¡¨å¤´ï¼Œç›´æ¥è½¬æ¢ 'timestamp' å­—ç¬¦ä¸²å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ `pd.read_csv()` è€Œé `header=None`
- é€šè¿‡ `DailyDataAggregator` ç»Ÿä¸€æ•°æ®è®¿é—®
- æ£€æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦ä¸ºè¡¨å¤´ï¼š`df.iloc[0]['timestamp']`

### é”™è¯¯ 2ï¼šæ—¶é—´æˆ³æ ¼å¼ä¸ä¸€è‡´

**é—®é¢˜**ï¼šæ··ç”¨ Unix æ—¶é—´æˆ³ã€ISO æ ¼å¼ã€æ—¥æœŸå­—ç¬¦ä¸²

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# ç»Ÿä¸€è½¬æ¢å‡½æ•°
def normalize_timestamp(ts):
    if isinstance(ts, str):
        if ts.isdigit():
            return int(ts)  # Unix timestamp
        else:
            return pd.to_datetime(ts).timestamp()  # ISO format
    return ts
```

### ç°è±¡ 3ï¼šå®æ—¶æ•°æ®æ—¶é—´æˆ³ â„¹ï¸ **ç³»ç»Ÿæ­£å¸¸è¡Œä¸º**

**ç°è±¡æè¿°**ï¼š

```text
æ­£å¸¸: 2025-07-13 00:00:00 UTC  (24å°æ—¶é—´éš”)
ä¸´æ—¶: 2025-07-13 07:08:54 UTC  (7.15å°æ—¶é—´éš”) â† å®æ—¶æ•°æ®
```

**å‡ºç°åŸå› **ï¼š

- å¢é‡æ›´æ–°æ—¶ï¼Œå½“æ—¥ `00:00:00 UTC` æ•°æ®å°šæœªç”Ÿæˆï¼ˆT+1 é€»è¾‘ï¼‰
- CoinGecko API è¿”å›å½“å‰æ—¶é—´çš„å®æ—¶ä»·æ ¼æ•°æ®
- è¿™æ˜¯ç³»ç»Ÿçš„æ­£å¸¸è¡Œä¸ºï¼Œä¸æ˜¯é”™è¯¯

**âœ… è‡ªåŠ¨æ ¡æ­£æœºåˆ¶**ï¼š

ä»·æ ¼æ›´æ–°å™¨ä½¿ç”¨**è¦†ç›–æ¨¡å¼**ï¼Œä¼šè‡ªåŠ¨æ ¡æ­£ï¼š

1. `update_with_smart_strategy()` é‡æ–°ä¸‹è½½å®Œæ•´å†å²æ•°æ®
2. å®Œå…¨æ›¿æ¢æ•´ä¸ª CSV æ–‡ä»¶ï¼Œä¸´æ—¶è®°å½•è‡ªåŠ¨è¢«æ­£ç¡®æ•°æ®æ›¿æ¢
3. ç¬¦åˆ"ç®€å•èƒœäºå¤æ‚"åŸåˆ™

**éªŒè¯æœºåˆ¶**ï¼š

```bash
python scripts/update_price_data.py
```

### é”™è¯¯ 3ï¼šæ—¶åŒºæ··ä¹±

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¡ **éƒ¨åˆ†è§£å†³ï¼Œä»æœ‰æ”¹è¿›ç©ºé—´**

**å·²æ­£ç¡®å¤„ç†**ï¼š

- âœ… æ‰€æœ‰ CoinGecko API æ•°æ®ç»Ÿä¸€ä½¿ç”¨ UTC
- âœ… æ‰¹é‡ä¸‹è½½å™¨å…ƒæ•°æ®ä½¿ç”¨ `datetime.now(timezone.utc)`
- âœ… API æ–‡æ¡£æ˜ç¡®æ ‡æ³¨ `00:00:00 UTC`

**ä»å­˜åœ¨çš„é—®é¢˜**ï¼š

- âš ï¸ ç»Ÿè®¡æ—¶é—´è®°å½•ä½¿ç”¨æœ¬åœ°æ—¶é—´ (`price_updater.py` ç¬¬ 311, 440 è¡Œ)
- âš ï¸ æŠ¥å‘Šæ–‡ä»¶å‘½åä½¿ç”¨æœ¬åœ°æ—¶é—´ (`price_updater.py` ç¬¬ 516 è¡Œ)
- âš ï¸ å¢é‡æ›´æ–°å™¨æ“ä½œæ—¥å¿—ä½¿ç”¨æœ¬åœ°æ—¶é—´

**å½±å“è¯„ä¼°**ï¼š

- ğŸŸ¢ **æ•°æ®è´¨é‡**: æ— å½±å“ï¼Œæ‰€æœ‰å¸ç§ä»·æ ¼æ•°æ®æ—¶é—´æˆ³æ­£ç¡®
- ğŸŸ¡ **ç”¨æˆ·ä½“éªŒ**: è½»å¾®å½±å“ï¼Œæ—¥å¿—å’ŒæŠ¥å‘Šæ—¶é—´å¯èƒ½ä¸ç”¨æˆ·æœŸæœ›ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# æ¨èï¼šç»Ÿä¸€ä½¿ç”¨ UTC
self.stats["start_time"] = datetime.now(timezone.utc)
self.stats["end_time"] = datetime.now(timezone.utc)

# æ–‡ä»¶å‘½åä¹Ÿä½¿ç”¨ UTC
report_name = f"smart_update_report_{datetime.now(timezone.utc).strftime('%Y%m%d_%H%M%S')}.txt"
```

**ä¿®å¤ä¼˜å…ˆçº§**: ä½ (ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æ”¹è¿›)

## é¡¹ç›®ä¸­çš„æ—¶é—´æˆ³ä½¿ç”¨æ¨¡å¼

### 1. CoinGecko API æ•°æ®

- è¿”å› Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼‰
- éœ€è¦é™¤ä»¥ 1000 è½¬æ¢ä¸ºç§’çº§
- æ—¶åŒºï¼šUTC

### 2. æ¯æ—¥æ•°æ®æ–‡ä»¶

- æ ¼å¼ï¼š`YYYY-MM-DD_crypto_data.csv`
- timestamp åˆ—ï¼šUnix æ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰
- åŒ…å«è¡¨å¤´è¡Œ

### 3. æ•°æ®èšåˆå™¨ (DailyDataAggregator)

- **æ¨èä½¿ç”¨**ï¼šé¿å…ç›´æ¥è¯»å– CSV
- è‡ªåŠ¨å¤„ç†è¡¨å¤´é—®é¢˜
- ç»Ÿä¸€æ—¶é—´æˆ³æ ¼å¼

## æœ€ä½³å®è·µ

### 1. æ•°æ®è¯»å–

```python
# æ¨èï¼šä½¿ç”¨èšåˆå™¨
from src.analysis.daily_data_aggregator import DailyDataAggregator
aggregator = DailyDataAggregator()
data = aggregator.load_daily_data(date_str)

# é¿å…ï¼šç›´æ¥è¯»å– CSV
# df = pd.read_csv(file_path, header=None)  # å®¹æ˜“å‡ºé”™
```

### 2. æ—¶é—´æˆ³è½¬æ¢

```python
# æ¨èï¼šæ˜ç¡®è½¬æ¢
timestamp = pd.to_datetime(date_str).timestamp()

# é¿å…ï¼šå‡è®¾æ ¼å¼
# timestamp = float(date_str)  # å¯èƒ½å¤±è´¥
```

### 3. æ—¥æœŸæ ¼å¼åŒ–

```python
# é¡¹ç›®æ ‡å‡†æ ¼å¼
date_str = datetime.now().strftime('%Y-%m-%d')  # YYYY-MM-DD
update_note = f"(æœ€è¿‘æ›´æ–°: {date_str})"
```

## è°ƒè¯•æ£€æŸ¥æ¸…å•

é‡åˆ°æ—¶é—´æˆ³ç›¸å…³é”™è¯¯æ—¶ï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

1. [ ] CSV æ–‡ä»¶æ˜¯å¦åŒ…å«è¡¨å¤´ï¼Ÿ
2. [ ] ä½¿ç”¨çš„æ˜¯ `DailyDataAggregator` è¿˜æ˜¯ç›´æ¥è¯»å–ï¼Ÿ
3. [ ] æ—¶é—´æˆ³æ ¼å¼æ˜¯å¦ä¸€è‡´ï¼ˆç§’çº§ vs æ¯«ç§’çº§ï¼‰ï¼Ÿ
4. [ ] æ—¶åŒºæ˜¯å¦æ­£ç¡®å¤„ç†ï¼Ÿ
5. [ ] æ•°æ®ç±»å‹æ˜¯å¦åŒ¹é…ï¼ˆstr vs int vs floatï¼‰ï¼Ÿ

## é¡¹ç›®ç‰¹å®šæ³¨æ„äº‹é¡¹

### daily_files ç›®å½•ç»“æ„

```text
data/daily/daily_files/
â”œâ”€â”€ 2024-01-01_crypto_data.csv  # åŒ…å«è¡¨å¤´
â”œâ”€â”€ 2024-01-02_crypto_data.csv  # åŒ…å«è¡¨å¤´
â””â”€â”€ ...
```

### è¡¨å¤´æ ¼å¼

```csv
symbol,name,current_price,market_cap,total_volume,price_change_24h,price_change_percentage_24h,market_cap_rank,timestamp
```

### DailyDataAggregator ä½¿ç”¨ç¤ºä¾‹

```python
# æ­£ç¡®æ–¹å¼
aggregator = DailyDataAggregator()
data = aggregator.load_daily_data('2024-01-01')
# data å·²ç»æ˜¯å¤„ç†å¥½çš„ DataFrameï¼ŒåŒ…å«æ­£ç¡®çš„æ—¶é—´æˆ³

# é”™è¯¯æ–¹å¼
df = pd.read_csv('2024-01-01_crypto_data.csv')
df['timestamp'] = df['timestamp'].astype(float)  # å¯èƒ½å¤±è´¥
```

---

**æé†’**ï¼šæ¯æ¬¡ä¿®æ”¹æ—¶é—´æˆ³ç›¸å…³ä»£ç åï¼Œç«‹å³è¿è¡Œç›¸å…³æµ‹è¯•ç¡®ä¿æ­£ç¡®æ€§ã€‚æµ‹è¯•è¦†ç›–ä»¥ä¸‹åœºæ™¯ï¼š

- åŒ…å«è¡¨å¤´çš„ CSV æ–‡ä»¶
- ä¸åŒæ—¶é—´æˆ³æ ¼å¼çš„æ•°æ®
- è¾¹ç•Œæ—¥æœŸï¼ˆæœˆåˆã€æœˆæœ«ã€å¹´åˆã€å¹´æœ«ï¼‰

**æ›´æ–°è®°å½•**ï¼š

- åˆ›å»ºæ—¥æœŸ: 2025-01-13
- æœ€è¿‘æ›´æ–°: 2025-07-14 (æ–°å¢å®æ—¶æ•°æ®æ—¶é—´æˆ³å¼‚å¸¸å¤„ç†)
